
<%= render 'layouts/nav_header' %>
<div class="container">
<h3>Search Result</h3>
  <% if !@results.nil? %>
    <table class="table table-hover main-table">
      <thead>
        <tr>
          <th>Student</th>
          <th>Student Email </th>
          <th>UID </th>
          <th>Permission Group</th>
          <th>Coaching Type</th>
          <th>Cohort</th>
          <th>DataSets</th>
        </tr>
      </thead>
      <% @temp_hash = {} %>
      <% @results.each do |result| %>
        <% @pk = result.email %>
        <tr>
          <td> <%= result.full_name %></td>
          <td> <%= result.email %></td>
          <td> <%= result.sid.to_s %></td>
          <td> <%= result.permission_group.title.to_s %></td>
          <td> <%= result.coaching_type.to_s %></td>
          <% if result.coaching_type == 'student' %>
             <td> <%= result.cohort ? result.cohort.title : "Not Available"%></td>
          <% else %>
              <td> N/A </td>
          <% end %>
          <td>
            <%= nav_link_to("View Artifacts", artifacts_path(user_id: result.id))  %>
            <%= link_to("<b>Clinical Phase Dataset NEW! (>= Med20)</b>".html_safe, user_competencies_path(user_id: result.id), class: "link-to-text-color") %><br>
            <%  hf_exists_in_FomExam(result.id).each do |block| %>
                <% cohort = block["cohort"] %>
                <% permission_group_id = block["permission_group_id"] %>
                <% course_code = block["course_code"] %>
                <% if !course_code.include? "DISABLED" %>
                  <% session[:attach_id] = -1 %>
                  <% session[:course_code] = course_code %>
                  <% session[:user_id] = result.id %>
                  <%= link_to("<b>#{cohort}:Foundation of Medicine: #{course_code} (New!)</b>".html_safe,
                          fom_exams_display_fom_path, target: '_blank') %> <br>
                <% else %>
                   <%= sanitize "<b>#{cohort}:Foundation of Medicine: #{course_code} (New!)</b><br />".html_safe %>
                <% end %>
            <% end %>

            <% cohort = hf_exists_in_PreceptorEval(result.id) %>
            <% if !cohort.blank? %>
              <%= link_to("<b>#{cohort}:Foundation of Medicine: Preceptorship Evaluations (Beta!)</b>".html_safe,
                      user_preceptor_evals_path(user_id: result.id, permission_group_id: result.permission_group_id), target: '_blank') %> <br>
            <% end %>

            <% if hf_has_csl_feedbacks(result.id) %>
              <% session[:user_id] = result.id %>
              <% session[:cohort] = cohort_title(result.permission_group_id) %>
              <%= link_to('<i><b>CSL Feedbacks from Qualtrics</b></i>'.html_safe, csl_feedbacks_index_path, target: '_blank') %>
              <br>

            <% end %>

            <% hf_datasets(result, @temp_hash).each do |dataset| %>
               <% sid = dataset.split("~").first %>
               <% if dataset.split("~").last.include? "Core Clinical/Electives" %>
                   <%= link_to dataset.split("~").last, polymorphic_path([hf_graph_type(dataset), :ls_report], sid: sid, pk: @pk),
                      class: "modal-click", 'data-target': '#modal-dataset' %> <br>
              <% else %>
                    <%= link_to dataset.split("~").last, polymorphic_path([hf_graph_type(dataset), :ls_report], sid: sid, pk: @pk),
                       class: "modal-click", 'data-target': '#modal-dataset' %> <br>
              <% end %>
            <% end %>
          </td>

        </tr>
      <% end %>
    </table>
    <% hf_write_hash(@temp_hash) %>

  <% end %>
</div>
